# 业绩种类删除策略说明

## 概述

业绩种类删除采用**保守策略**，优先保护数据完整性，避免误删重要数据。

## 删除策略

### 1. 普通删除（推荐）
- **接口**: `DELETE /perform-types/{performTypeId}`
- **策略**: 只允许删除未被使用的业绩种类
- **检查**: 删除前检查是否有业绩使用该种类
- **结果**: 
  - 无相关业绩：直接删除
  - 有相关业绩：返回错误提示

### 2. 强制删除（谨慎使用）
- **接口**: `DELETE /perform-types/{performTypeId}/force`
- **策略**: 级联删除相关业绩和种类
- **风险**: 会删除所有使用该种类的业绩数据
- **适用场景**: 确认要删除所有相关数据时

## 业务逻辑

### 数据关系
```
业绩种类 (perform_type)
    ↓ (1:N)
业绩 (perform)
    ↓ (1:N)
附件 (perform_file)
```

### 删除流程

#### 普通删除流程
1. 检查业绩种类是否存在
2. 检查是否有业绩使用该种类
3. 如果有使用中：返回错误
4. 如果无使用：删除业绩种类

#### 强制删除流程
1. 检查业绩种类是否存在
2. 检查是否有业绩使用该种类
3. 如果有使用中：先删除相关业绩（级联删除附件）
4. 删除业绩种类

## 使用建议

### 推荐使用普通删除
- 日常维护时使用
- 安全可靠，不会误删数据
- 如果无法删除，说明有重要数据需要保护

### 谨慎使用强制删除
- 仅在确认要清理所有相关数据时使用
- 建议先备份数据
- 操作不可逆，请谨慎

## 错误处理

### 普通删除错误
```json
{
    "code": 400,
    "message": "该业绩种类正在使用中，无法删除。如需强制删除，请使用forceDelete=true参数",
    "data": null
}
```

### 强制删除成功
```json
{
    "code": 200,
    "message": "业绩种类删除成功",
    "data": null
}
```

## 数据库约束

- 业绩表外键约束：`perform_type_id` 关联 `perform_type.perform_type_id`
- 附件表外键约束：`perform_id` 关联 `perform.perform_id`
- 删除时自动级联处理

## 测试建议

1. 先测试普通删除（应该失败）
2. 确认错误信息正确
3. 再测试强制删除（应该成功）
4. 验证相关数据是否被正确删除 