# 附件下载说明

## 设计决策

### 为什么移除下载API？

1. **云端存储架构**
   - 附件文件存储在云端（如阿里云OSS、腾讯云COS等）
   - 云端存储提供直接访问URL
   - 无需后端转发，性能更好

2. **性能优势**
   - 直接访问云端URL，减少后端服务器负载
   - 云端通常有CDN加速，下载速度更快
   - 节省后端带宽资源

3. **架构简化**
   - 减少不必要的API复杂度
   - 降低维护成本
   - 避免文件传输的安全风险

## 前端实现方案

### 方案1：直接使用URL下载
```javascript
// 获取附件详情
const response = await fetch('/performance-service/files/1');
const fileInfo = await response.json();

// 直接下载
const link = document.createElement('a');
link.href = fileInfo.data.performFileUrl;  // 云端URL
link.download = fileInfo.data.performFileName;
link.click();
```

### 方案2：新窗口打开
```javascript
// 新窗口打开文件
window.open(fileInfo.data.performFileUrl, '_blank');
```

### 方案3：iframe下载
```javascript
// 使用iframe下载
const iframe = document.createElement('iframe');
iframe.style.display = 'none';
iframe.src = fileInfo.data.performFileUrl;
document.body.appendChild(iframe);
```

## 权限控制

### 访问控制
- 附件详情接口仍然需要权限验证
- 只有有权限的用户才能获取附件URL
- 云端URL可以设置访问权限和过期时间

### 安全考虑
- 云端存储可以设置防盗链
- 可以生成带签名的临时URL
- 支持访问频率限制

## 接口变更

### 移除的接口
```
GET /performance-service/files/{id}/download
```

### 保留的接口
```
GET /performance-service/files/{id}  # 获取附件详情（包含URL）
```

## 使用流程

1. **获取附件详情**
   ```
   GET /performance-service/files/1
   ```

2. **响应示例**
   ```json
   {
     "code": 0,
     "message": "附件详情获取成功",
     "data": {
       "performFileId": 1,
       "performFileName": "教学成果报告.pdf",
       "performFileUrl": "https://oss.example.com/files/report.pdf",
       "performFileType": "pdf",
       "fileSize": 1024000
     }
   }
   ```

3. **前端下载**
   ```javascript
   // 使用返回的URL直接下载
   window.open(response.data.performFileUrl, '_blank');
   ```

## 优势总结

- ✅ **性能更好**：直接访问云端，无需后端转发
- ✅ **架构简单**：减少API复杂度
- ✅ **成本更低**：节省后端资源
- ✅ **扩展性好**：云端存储天然支持高并发
- ✅ **安全性高**：云端提供完善的安全机制 